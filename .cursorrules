# Playwright Best Practices - Cursor Rules

This project follows Playwright best practices and industry standards. Follow these guidelines when writing or modifying tests.

## Test Organization

- **Platform Separation**: Tests are organized by platform in separate directories:
  - `/tests/website-livewire` - Public website tests
  - `/tests/admin` - Admin management tests
- **File Naming**: Use descriptive names ending with `.spec.ts` (e.g., `homepage.spec.ts`, `login.spec.ts`)
- **Test Structure**: Group related tests using `test.describe()` blocks

## Locator Strategies (Priority Order)

1. **`getByRole()`** - Preferred for accessibility and semantic meaning
   ```typescript
   page.getByRole('button', { name: 'Submit' })
   page.getByRole('heading', { name: 'Welcome' })
   ```

2. **`getByLabel()`** - For form inputs
   ```typescript
   page.getByLabel('Email')
   page.getByLabel('Password')
   ```

3. **`getByText()`** - For text content
   ```typescript
   page.getByText('Welcome back')
   ```

4. **`getByPlaceholder()`** - For input placeholders
   ```typescript
   page.getByPlaceholder('Enter your email')
   ```

5. **`getByTestId()`** - For test-specific IDs (add `data-testid` attributes)
   ```typescript
   page.getByTestId('submit-button')
   ```

6. **CSS/XPath Selectors** - Use only as last resort when semantic locators don't work
   ```typescript
   // Avoid if possible
   page.locator('.button-submit')
   ```

## Page Object Model (POM)

- **Always use Page Objects** - Never use direct selectors in tests
- **Extend BasePage** - All page objects should extend `BasePage` class
- **Organize by Platform** - Page objects in `/pages/{platform}/` directories
- **Naming Convention**: `{page-name}.page.ts` (e.g., `homepage.page.ts`, `login.page.ts`)

Example:
```typescript
// pages/website-livewire/homepage.page.ts
export class HomepagePage extends BasePage {
  readonly submitButton: Locator;
  
  constructor(page: Page) {
    super(page);
    this.submitButton = page.getByRole('button', { name: 'Submit' });
  }
  
  async clickSubmit(): Promise<void> {
    await this.submitButton.click();
  }
}
```

## Fixtures

- **Use Custom Fixtures** - Import from `/fixtures/base.fixtures.ts` instead of `@playwright/test`
- **Authentication Fixtures** - Use `/fixtures/auth.fixtures.ts` for authenticated tests
- **Page Object Fixtures** - Access page objects through fixtures, not direct instantiation

Example:
```typescript
import { test, expect } from '../fixtures/base.fixtures';

test('example', async ({ homepagePage }) => {
  await homepagePage.navigate();
});
```

## Test Structure (AAA Pattern)

Follow Arrange-Act-Assert pattern:

```typescript
test('user can login', async ({ loginPage }) => {
  // Arrange: Set up test data and state
  await loginPage.navigate();
  
  // Act: Perform the action being tested
  await loginPage.login('user@example.com', 'password123');
  
  // Assert: Verify the expected outcome
  await expect(page).toHaveURL(/dashboard/);
});
```

## Waiting Strategies

- **Prefer Auto-Waiting** - Playwright automatically waits for elements
- **Explicit Waits** - Use `waitFor()` only when necessary
- **Avoid `wait()`** - Never use `page.waitForTimeout()` - use element waits instead
- **Network Idle** - Use `waitForLoadState('networkidle')` for SPA navigation

```typescript
// Good: Auto-waiting
await page.getByRole('button').click();

// Good: Explicit wait when needed
await page.getByRole('button').waitFor({ state: 'visible' });

// Bad: Never use fixed timeouts
await page.waitForTimeout(5000); // ❌
```

## Assertions

- **Use `expect()` from Playwright** - Not Jest or other assertion libraries
- **Prefer Playwright assertions** - They auto-wait and provide better error messages
- **Use appropriate matchers**:
  ```typescript
  await expect(locator).toBeVisible();
  await expect(locator).toHaveText('Expected text');
  await expect(page).toHaveURL(/dashboard/);
  await expect(locator).toHaveCount(3);
  ```

## Tags

- **Tag Tests Appropriately** - Use tags for test categorization
- **Available Tags**:
  - `@smoke` - Critical tests that verify basic functionality
  - `@regression` - Full regression test suite
  - `@critical` - High-priority tests
  - `@e2e` - End-to-end tests
  - Platform-specific tags: `@website-livewire`, `@admin`

Example:
```typescript
test('@smoke @critical user can login', async ({ loginPage }) => {
  // test code
});
```

Run tagged tests:
```bash
npx playwright test --grep @smoke
npx playwright test --grep @critical
```

## URLs and Navigation

- **Use `baseURL`** - Never hardcode full URLs, use relative paths
- **Project Configuration** - `baseURL` is set per project in `playwright.config.ts`
- **Relative Paths** - Use `/path` instead of `https://example.com/path`

```typescript
// Good: Uses baseURL from config
await page.goto('/dashboard');

// Bad: Hardcoded URL
await page.goto('https://joaoestima.com/dashboard'); // ❌
```

## Test Independence

- **Isolated Tests** - Each test should be independent and runnable in isolation
- **No Test Dependencies** - Tests should not depend on execution order
- **Clean State** - Use fixtures for setup/teardown, not shared state between tests

## Code Style

- **TypeScript** - Use TypeScript for type safety
- **Async/Await** - Always use async/await, never mix with promises
- **Descriptive Names** - Use clear, descriptive test and function names
- **Comments** - Add comments for complex logic, but prefer self-documenting code

## Best Practices Summary

✅ DO:
- Use Page Object Model for all page interactions
- Use semantic locators (`getByRole`, `getByLabel`, `getByText`)
- Use custom fixtures for shared setup
- Tag tests appropriately
- Use `baseURL` from project config
- Follow AAA pattern (Arrange, Act, Assert)
- Keep tests independent and idempotent
- Use TypeScript for type safety

❌ DON'T:
- Use CSS selectors unless absolutely necessary
- Hardcode URLs - use relative paths with `baseURL`
- Use `page.waitForTimeout()` - use element waits
- Mix direct selectors with Page Objects
- Create test dependencies
- Skip fixtures for common setup
- Use non-semantic locators as first choice

## Project-Specific Guidelines

- **Multiple Platforms**: This project tests multiple platforms (website-livewire, admin)
- **Run Specific Platform**: Use `--project` flag to run tests for specific platform
  ```bash
  npx playwright test --project=website-livewire-chromium
  npx playwright test --project=admin-chromium
  ```
- **Shared Code**: Put shared utilities in `/utils`, shared fixtures in `/fixtures`
- **Test Data**: Store test data in `/data` directory

